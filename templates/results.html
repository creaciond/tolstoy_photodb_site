{% extends "base.html" %}

{% block pagetitle %}База данных фотографий Л.Н. Толстого: Результаты поиска{% endblock %}

{% block content %}
<!-- title section + call to action -->
<div class="section no-pad-bot">
    <div class="container">
        <h2 class="header center">Результаты поиска</h2>
    </div>
</div>
<!-- main body content -->
<div class="container" id="content-main">
    {% if photos_results %}
        <table>
            <thead>
                <tr>
                    <td><b>ID</b></td>
                    <td><b>Название фотографии</b></td>
                    <td><b>Место создания</b></td>
                    <td><b>Описание</b></td>
                    <td><b>Год создания</b></td>
                    <td><b>Миниатюра</b></td>
                    <td><b>Скачать фотографию</b></td>

                </tr>
            </thead>
            <tbody>
            {% for photo in photos_results %}
                <tr>
                    <td>{{ photo.id_photo }}</td>
                    <td>{{ photo.title }}</td>
                    <td>{{ photo.location.location_name }}</td>
                    <td>{{ photo.photo_description }}</td>
                    <td>{{ photo.year }}</td>
                    <td><img class="miniature" src="{{ url_for('static', filename=photo.files[0].miniature_file) }}" alt="{{ photo.location.location_name }}" /></td>
                    <td>{{ photo.files[0].fullsize_file }}</td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    {% else %}
    <p>Кажется, ничего не нашлось. Попробуйте поискать что-то другое?</p>
    {% endif %}
</div>
    <div class="fullscreen fullscreen_hidden">
    <img class="fullscreen_img" src="" alt="" />
    </div>
    <script>
    const images = Array.from(document.querySelectorAll('.miniature'));
    const fullscreenPopup = document.querySelector('.fullscreen');
    const fullscreenImg = document.querySelector('.fullscreen_img');
    images.forEach((img) => {
        img.addEventListener('click', (evt) => {
            console.log(evt.target);
            fullscreenImg.src = evt.target.src.replace('miniatures', 'fullsize');
            fullscreenImg.alt = evt.target.alt;
            fullscreenImg.addEventListener('click', () => {
                fullscreenPopup.classList.add('fullscreen_hidden');
            })
            fullscreenPopup.classList.remove('fullscreen_hidden');
        })
    })
    </script>
{% endblock %}